{
  "version": 3,
  "sources": ["../src/slider-simplex.ts"],
  "sourcesContent": ["/**\n * Slider Simplex\n *\n * @author Takuto Yanagida\n * @version 2025-03-26\n */\n\nimport { getStylePropertyBool, getStylePropertyFloat, getStylePropertyString } from './custom-property';\nimport { detectTouch, repeatAnimationFrame, initializeViewportDetection, callAfterDocumentReady, wrapAround } from './common';\n\nimport { Background } from './part-background.js';\nimport { Navigation } from './part-navigation';\nimport { Pagination } from './part-pagination';\nimport { Indicator } from './part-indicator';\nimport { Selector } from './part-selector.js';\n\nimport { Slide } from './slide';\nimport { Transition, TransitionFade, TransitionSlide, TransitionScroll } from './transition';\n\nconst NS          = 'slider-simplex';\nconst CLS_SLIDES  = 'slides';\n\nconst CLS_START   = 'start';\nconst CLS_VIEW    = 'view';\nconst CLS_PAUSE   = 'pause';\nconst CLS_SCROLL  = 'scroll';\n\nconst CP_EFFECT_TYPE      = '--effect-type';\nconst CP_DURATION_TIME    = '--duration-time';\nconst CP_TRANSITION_TIME  = '--transition-time';\n\nconst CP_RANDOMIZE_TIMING = '--randomize-timing';\nconst CP_RANDOM_RATE      = '--random-rate';\n\nconst CP_SHOW_BACKGROUND  = '--show-background';\nconst CP_SHOW_SIDE_SLIDE  = '--show-side-slide';\n\nconst CP_CREATE_NAVIGATION = '--create-navigation';\nconst CP_CREATE_PAGINATION = '--create-pagination';\nconst CP_CREATE_SELECTOR   = '--create-selector';\n\nconst CP_VIEW_OFFSET = '--view-offset';\n\nexport class SliderSimplex {\n\n\tstatic create(id: string | null): SliderSimplex | null {\n\t\tif (id) {\n\t\t\tconst r: HTMLElement = document.getElementById(id) as HTMLElement;\n\t\t\tif (r) {\n\t\t\t\treturn new SliderSimplex(r);\n\t\t\t}\n\t\t} else {\n\t\t\tfor (const r of document.getElementsByClassName(NS)) {\n\t\t\t\tnew SliderSimplex(r as HTMLElement);\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\t#root: HTMLElement;\n\n\t#effectType      : string\n\t#timeDur         : number\n\t#timeTran        : number\n\t#randomRate      : number\n\n\t#showBackground  : boolean;\n\t#showSideSlide   : boolean;\n\n\t#createNavigation: boolean;\n\t#createPagination: boolean;\n\t#createSelector  : boolean;\n\n\t#lis    : HTMLLIElement[];\n\t#size   : number;\n\t#slides : Slide[] = [];\n\t#effect!: Transition;\n\n\t#onTransitionEnd: (() => void) | null = null;\n\n\t#selector  : Selector   | null = null;\n\t#indicator : Indicator  | null = null;\n\t#pagination: Pagination | null = null;\n\t#background: Background | null = null;\n\n\t#curIdx      : number  = 0;\n\t#nextStepTime: number  = 0;\n\t#isWaiting   : boolean = false;\n\n\tconstructor(root: HTMLElement) {\n\t\tthis.#root = root;\n\n\t\tthis.#effectType       = getStylePropertyString(this.#root, CP_EFFECT_TYPE, 'fade');\n\t\tthis.#timeDur          = getStylePropertyFloat(this.#root, CP_DURATION_TIME, 8);\n\t\tthis.#timeTran         = getStylePropertyFloat(this.#root, CP_TRANSITION_TIME, 1);\n\n\t\tconst rt: boolean | null = getStylePropertyBool(this.#root, CP_RANDOMIZE_TIMING, null);\n\t\tif (rt) {\n\t\t\tthis.#randomRate = getStylePropertyFloat(this.#root, CP_RANDOM_RATE, 10);\n\t\t} else if (rt === null) {\n\t\t\tthis.#randomRate = getStylePropertyFloat(this.#root, CP_RANDOM_RATE, 0);\n\t\t} else {\n\t\t\tthis.#randomRate = 0;\n\t\t}\n\t\tthis.#showBackground   = getStylePropertyBool(this.#root, CP_SHOW_BACKGROUND, false);\n\t\tthis.#showSideSlide    = getStylePropertyBool(this.#root, CP_SHOW_SIDE_SLIDE, false);\n\n\t\tthis.#createNavigation = getStylePropertyBool(this.#root, CP_CREATE_NAVIGATION);\n\t\tthis.#createPagination = getStylePropertyBool(this.#root, CP_CREATE_PAGINATION);\n\t\tthis.#createSelector   = getStylePropertyBool(this.#root, CP_CREATE_SELECTOR);\n\n\t\tconst viewOffset: number = getStylePropertyFloat(this.#root, CP_VIEW_OFFSET, 100);\n\n\t\t// ----\n\n\t\tconst ul   = this.#root.querySelector('.' + CLS_SLIDES) as HTMLElement;\n\t\tthis.#lis  = Array.from(ul.getElementsByTagName('li'));\n\t\tthis.#size = this.#lis.length;\n\n\t\tfor (const li of this.#lis) {\n\t\t\tli.dataset.effectType = li.dataset.effectType ?? this.#effectType;\n\t\t}\n\t\tif (this.#showBackground) {\n\t\t\tthis.#background = new Background(this.#root, this.#lis);\n\t\t}\n\t\tif (this.#showSideSlide) {\n\t\t\tul.style.overflow = 'visible';\n\t\t}\n\t\tthis.initSlides();\n\t\tdetectTouch(this.#root);\n\t\tinitializeViewportDetection(this.#root, CLS_VIEW, viewOffset);\n\t\tcallAfterDocumentReady(async (): Promise<void> => this.start());\n\t}\n\n\tgetController() {\n\t\tconst fs = {\n\t\t\tmove: (idx: number): void => this.transition(idx, this.#size === 2 ? 1 : 0),\n\t\t\tnext: (): void => this.transition((this.#curIdx === this.#size - 1) ? 0               : (this.#curIdx + 1),  1),\n\t\t\tprev: (): void => this.transition((this.#curIdx === 0            ) ? (this.#size - 1) : (this.#curIdx - 1), -1),\n\n\t\t\tonTransitionEnd: (fn: () => void): void => { this.#onTransitionEnd = fn; }\n\t\t};\n\t\treturn fs;\n\t}\n\n\n\t// -------------------------------------------------------------------------\n\n\n\tprivate initSlides(): void {\n\t\tif (this.#effectType === 'scroll' && 1 < this.#size && this.#size < 5) {\n\t\t\tthis.cloneLis();\n\t\t\tif (this.#size === 2) {\n\t\t\t\tthis.cloneLis();\n\t\t\t}\n\t\t}\n\t\tconst isScroll: boolean = this.#root.classList.contains(CLS_SCROLL);\n\n\t\tfor (let i: number = 0; i < this.#lis.length; i += 1) {\n\t\t\tconst li: HTMLElement = this.#lis[i];\n\t\t\tif (isScroll) {\n\t\t\t\tli.classList.add(CLS_SCROLL);\n\t\t\t}\n\t\t\tconst slide = new Slide(li, i % this.#size, this.#size);\n\t\t\tthis.#slides.push(slide);\n\t\t}\n\t\tconst ro = new ResizeObserver((): void => {\n\t\t\tfor (const s of this.#slides) {\n\t\t\t\ts.onResize();\n\t\t\t}\n\t\t});\n\t\tro.observe(this.#root);\n\n\t\tswitch (this.#effectType) {\n\t\t\tdefault      :\n\t\t\tcase 'fade'  : this.#effect = new TransitionFade(this.#slides, this.#timeTran); break;\n\t\t\tcase 'slide' : this.#effect = new TransitionSlide(this.#slides, this.#timeTran); break;\n\t\t\tcase 'scroll': this.#effect = new TransitionScroll(this.#slides, this.#timeTran); break;\n\t\t}\n\t}\n\n\tprivate cloneLis(): void {\n\t\tfor (let i: number = 0; i < this.#size; i += 1) {\n\t\t\tconst li: HTMLLIElement = this.#lis[i];\n\t\t\tconst nls = this.#lis[i].cloneNode(true) as HTMLLIElement;\n\t\t\tthis.#lis.push(nls);\n\t\t\tli.parentNode?.appendChild(nls);\n\t\t}\n\t}\n\n\tprivate async start(): Promise<void> {\n\t\tif (1 < this.#size) {\n\t\t\tconst fn = (idx: number, dir: -1 | 0 | 1) => this.transition(idx, dir);\n\n\t\t\tnew Navigation(this.#root, this.#timeTran, fn, this.#createNavigation);\n\t\t\tthis.#pagination = new Pagination(this.#root, this.#size, fn, this.#createPagination);\n\t\t\tthis.#selector   = new Selector(this.#root, this.#lis, this.#size, fn, this.#createSelector);\n\t\t}\n\t\tthis.#indicator = new Indicator(this.#root, this.#size);\n\n\t\tconst rs: boolean[] = await Promise.all(this.#slides.map((s: Slide): any => s.isLoaded()));\n\t\tif (rs.every((result: any): boolean => result === true)) {\n\t\t\tthis.transition(0, 0);\n\t\t\tsetTimeout((): void => {\n\t\t\t\tthis.#root.classList.add(CLS_START);\n\t\t\t\trepeatAnimationFrame((_t: number, _dt: number): void => this.step());\n\t\t\t}, 200);\n\t\t\tconsole.log(`Slider Simplex (#${this.#root.id}): successfully started`);\n\t\t} else {\n\t\t\tconsole.log(`Slider Simplex (#${this.#root.id}): failed to load media`);\n\t\t}\n\t}\n\n\n\t// -------------------------------------------------------------------------\n\n\n\tprivate transition(idx: number, dir: -1 | 0 | 1): void {\n\t\tif (idx === -1) {\n\t\t\tidx = wrapAround(this.#curIdx + dir, this.#size);\n\t\t}\n\t\tif (this.#background) this.#background.transition(idx);\n\t\tif (this.#pagination) this.#pagination.transition(idx);\n\t\tif (this.#indicator)  this.#indicator.transition(idx);\n\t\tif (this.#selector)   this.#selector.transition(idx);\n\n\t\tthis.#effect.transition(idx, dir);\n\t\tthis.#curIdx    = idx;\n\t\tthis.#isWaiting = true;\n\n\t\tif (1 < this.#size) {\n\t\t\tconst dt: number = this.#slides[idx].getDuration(this.#timeDur, this.#timeTran, this.#randomRate);\n\t\t\tthis.#nextStepTime = window.performance.now() + dt * 1000;\n\t\t}\n\t}\n\n\tprivate step(): void {\n\t\tif (this.#isWaiting && !this.#effect.isTransitioning()) {\n\t\t\tif (this.#onTransitionEnd) this.#onTransitionEnd();\n\t\t\tthis.#isWaiting = false;\n\t\t}\n\t\tif (window.performance.now() < this.#nextStepTime) {\n\t\t\treturn;\n\t\t}\n\t\tif (!this.#root.classList.contains(CLS_VIEW) || this.#root.classList.contains(CLS_PAUSE)) {\n\t\t\treturn;\n\t\t}\n\t\tthis.#nextStepTime = Number.MAX_VALUE;\n\t\tthis.transition(-1, 1);\n\t}\n\n}\n"],
  "mappings": "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",
  "names": ["getStylePropertyBool", "getStylePropertyFloat", "getStylePropertyString", "detectTouch", "repeatAnimationFrame", "initializeViewportDetection", "callAfterDocumentReady", "wrapAround", "Background", "Navigation", "Pagination", "Indicator", "Selector", "Slide", "TransitionFade", "TransitionSlide", "TransitionScroll", "NS", "CLS_SLIDES", "CLS_START", "CLS_VIEW", "CLS_PAUSE", "CLS_SCROLL", "CP_EFFECT_TYPE", "CP_DURATION_TIME", "CP_TRANSITION_TIME", "CP_RANDOMIZE_TIMING", "CP_RANDOM_RATE", "CP_SHOW_BACKGROUND", "CP_SHOW_SIDE_SLIDE", "CP_CREATE_NAVIGATION", "CP_CREATE_PAGINATION", "CP_CREATE_SELECTOR", "CP_VIEW_OFFSET", "id", "r", "#root", "#effectType", "#timeDur", "#timeTran", "#randomRate", "#showBackground", "#showSideSlide", "#createNavigation", "#createPagination", "#createSelector", "#lis", "#size", "#slides", "#effect", "#onTransitionEnd", "#selector", "#indicator", "#pagination", "#background", "#curIdx", "#nextStepTime", "#isWaiting", "root", "rt", "viewOffset", "ul", "li", "idx", "fn", "isScroll", "i", "slide", "nls", "dir", "s", "result", "_t", "_dt", "dt"]
}
